{% extends 'inicio/base_admin.html' %}

{% block titulo %}Notificaciones{% endblock %}

{% block contenido %}
<div class="space-y-6 animate-fade-in">
  <div>
    <h1 class="text-3xl font-bold text-gradient">Centro de notificaciones</h1>
    <p class="text-sm text-gray-300 mt-1">Listado y gestión de avisos.</p>
  </div>

    <!-- tabla -->
  <div class="bg-gray-900/70 rounded-lg border border-white/10 shadow-lg overflow-hidden">
    <table class="w-full text-sm">
      <thead class="bg-white/5 text-gray-300 uppercase tracking-wide text-xs">
        <tr>
          <th class="px-4 py-3 text-left">Tipo</th>
          <th class="px-4 py-3 text-left">Destinatario</th>
          <th class="px-4 py-3 text-left">Relacionado</th>
          <th class="px-4 py-3 text-left">Programada para</th>
          <th class="px-4 py-3 text-left">Estado</th>
          <th class="px-4 py-3 text-center">Acciones</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-white/5">
        {% for n in notificaciones %}
        <tr class="hover:bg-white/5 transition-colors">
          <td class="px-4 py-3 text-gray-200">{{ n.tipo }}</td>
          <td class="px-4 py-3 text-gray-200">{{ n.destinatario }}</td>
          <td class="px-4 py-3 text-gray-200">{{ n.relacionado }}</td>
          <td class="px-4 py-3 text-gray-200">{{ n.programada_para|date:"d/m/Y H:i" }}</td>
          <td class="px-4 py-3">
            {% if n.estado == 'pendiente' %}
              <span class="px-2 py-1 text-xs rounded-full bg-blue-500/20 text-blue-300 font-medium">Pendiente</span>
            {% elif n.estado == 'enviada' %}
              <span class="px-2 py-1 text-xs rounded-full bg-green-500/20 text-green-300 font-medium">Enviada</span>
            {% elif n.estado == 'fallida' %}
              <span class="px-2 py-1 text-xs rounded-full bg-red-500/20 text-red-300 font-medium">Fallida</span>
            {% elif n.estado == 'leida' %}
              <span class="px-2 py-1 text-xs rounded-full bg-amber-500/20 text-amber-300 font-medium">Leída</span>
            {% endif %}
          </td>
          <td class="px-4 py-3 text-center">
            <div class="flex justify-center gap-3">
              <a href="{% url 'reintentar_notificacion' n.id %}" class="px-3 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-xs shadow">Reintentar</a>
              <a href="{% url 'marcar_leida' n.id %}" class="px-3 py-1 bg-amber-500 hover:bg-amber-600 text-white rounded-lg text-xs shadow">Marcar leída</a>
            </div>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="6" class="px-4 py-6 text-center text-gray-400">
            No hay notificaciones registradas.
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- paginacion -->
  {% if notificaciones.has_other_pages %}
  <div class="flex justify-center mt-4">
    <nav class="flex items-center space-x-1">
      {% if notificaciones.has_previous %}
        <a href="?page=1" class="px-3 py-1 rounded bg-gray-700 text-white hover:bg-gray-600">«</a>
        <a href="?page={{ notificaciones.previous_page_number }}" class="px-3 py-1 rounded bg-gray-700 text-white hover:bg-gray-600">‹</a>
      {% endif %}
      {% for num in notificaciones.paginator.page_range %}
        {% if notificaciones.number == num %}
          <span class="px-3 py-1 rounded bg-pink-500 text-white font-semibold">{{ num }}</span>
        {% elif num > notificaciones.number|add:-3 and num < notificaciones.number|add:3 %}
          <a href="?page={{ num }}" class="px-3 py-1 rounded bg-gray-700 text-white hover:bg-gray-600">{{ num }}</a>
        {% endif %}
      {% endfor %}
      {% if notificaciones.has_next %}
        <a href="?page={{ notificaciones.next_page_number }}" class="px-3 py-1 rounded bg-gray-700 text-white hover:bg-gray-600">›</a>
        <a href="?page={{ notificaciones.paginator.num_pages }}" class="px-3 py-1 rounded bg-gray-700 text-white hover:bg-gray-600">»</a>
      {% endif %}
    </nav>
  </div>
  {% endif %}
</div>
{% endblock %}
