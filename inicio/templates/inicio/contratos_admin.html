{% extends 'inicio/base_admin.html' %}

{% block titulo %}Contratos{% endblock %}

{% block contenido %}
<div class="space-y-6 animate-fade-in">
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
    <div>
      <h1 class="text-3xl font-bold text-gradient">Gestión de Contratos</h1>
      <p class="text-sm text-gray-300 mt-1">Listado de contratos actuales, vencidos o próximos a vencer.</p>
    </div>
    <a href="{% url 'crear_contrato' %}"
       class="flex items-center gap-2 px-4 py-2.5 rounded-lg text-white font-medium shadow-md transition-all bg-indigo-500 hover:bg-indigo-600">
       ➕ Nuevo contrato
    </a>
  </div>

 <!-- filtros -->
<form method="get" class="flex flex-wrap gap-3">
  <input type="text" name="search" value="{{ search_query }}"
         placeholder="Buscar por inquilino o departamento..."
         class="flex-1 min-w-[200px] bg-gray-700 text-white rounded-lg px-3 py-2 text-sm placeholder-gray-400
                focus:outline-none focus:ring-2 focus:ring-pink-500 shadow-inner">

  <select name="estado"
          class="bg-gray-700 text-white rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-pink-500 shadow-inner">
    <option {% if not estado_filter or estado_filter == 'Estado' %}selected{% endif %}>Estado</option>
    <option value="activo" {% if estado_filter == 'activo' %}selected{% endif %}>Activo</option>
    <option value="por_vencer" {% if estado_filter == 'por_vencer' %}selected{% endif %}>Por vencer</option>
    <option value="finalizado" {% if estado_filter == 'finalizado' %}selected{% endif %}>Finalizado</option>
    <option value="pendiente" {% if estado_filter == 'pendiente' %}selected{% endif %}>Pendiente</option>
    <option value="cancelado" {% if estado_filter == 'cancelado' %}selected{% endif %}>Cancelado</option>
  </select>

  <button type="submit"
          class="px-4 py-2 rounded-lg bg-pink-500 hover:bg-pink-600 text-white font-medium shadow-md transition">
    Filtrar
  </button>
</form>

 <!-- contador -->
<p class="text-sm text-gray-400 mt-1">
  Resultados encontrados: <span class="font-semibold text-white">{{ total_resultados }}</span>
</p>

  <!-- tabla -->
  <div class="bg-gray-900/70 rounded-lg border border-white/10 shadow-lg overflow-hidden">
    <table class="w-full text-sm">
      <thead class="bg-white/5 text-gray-300 uppercase tracking-wide text-xs">
        <tr>
          <th class="px-4 py-3 text-left">#</th>
          <th class="px-4 py-3 text-left">Inquilino</th>
          <th class="px-4 py-3 text-left">Departamento</th>
          <th class="px-4 py-3 text-left">Inicio</th>
          <th class="px-4 py-3 text-left">Fin</th>
          <th class="px-4 py-3 text-left">Estado</th>
          <th class="px-4 py-3 text-center">Acciones</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-white/5">
        {% for contrato in contratos %}
        <tr class="hover:bg-white/5 transition-colors">
          <td class="px-4 py-3 text-gray-200">{{ contrato.id }}</td>
          <td class="px-4 py-3 text-gray-200">{{ contrato.arrendatario.username }}</td>
          <td class="px-4 py-3 text-gray-200">{{ contrato.numero_departamento }}</td>
          <td class="px-4 py-3 text-gray-200">{{ contrato.fecha_inicio }}</td>
          <td class="px-4 py-3 text-gray-200">{{ contrato.fecha_fin }}</td>
          <td class="px-4 py-3">
            {% if contrato.estado == 'activo' %}
              <span class="px-2 py-1 text-xs rounded-full bg-green-500/20 text-green-300 font-medium">Activo</span>
            {% elif contrato.estado == 'por_vencer' %}
              <span class="px-2 py-1 text-xs rounded-full bg-yellow-500/20 text-yellow-300 font-medium">Por vencer</span>
            {% else %}
              <span class="px-2 py-1 text-xs rounded-full bg-gray-400/20 text-gray-300 font-medium">Finalizado</span>
            {% endif %}
          </td>
          <td class="px-4 py-3 text-center space-x-2">
            <a href="{% url 'detalle_contrato' contrato.id %}" class="text-indigo-300 hover:text-indigo-200 underline-offset-2 hover:underline">Ver</a>
            <a href="{% url 'editar_contrato' contrato.id %}" class="text-pink-300 hover:text-pink-200 underline-offset-2 hover:underline">Editar</a>
            <a href="{% url 'eliminar_contrato' contrato.id %}" class="text-red-400 hover:text-red-300 underline-offset-2 hover:underline">Eliminar</a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="7" class="px-4 py-6 text-center text-gray-300">
            No hay contratos registrados.
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>



<!-- paginación -->
{% if is_paginated %}
<div class="flex justify-center items-center gap-1 mt-4">
  {% if page_obj.has_previous %}
    <a href="?page={{ page_obj.previous_page_number }}&search={{ search_query }}&estado={{ estado_filter }}"
       class="px-3 py-1 rounded-l border border-white/10 bg-white/5 text-gray-300 hover:bg-white/10 transition-colors">
       «
    </a>
  {% else %}
    <span class="px-3 py-1 rounded-l border border-white/10 bg-gray-800 text-gray-500 cursor-not-allowed">«</span>
  {% endif %}

  <span class="px-4 py-1 border-t border-b border-white/10 bg-white/5 text-gray-300">
    Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}
  </span>

  {% if page_obj.has_next %}
    <a href="?page={{ page_obj.next_page_number }}&search={{ search_query }}&estado={{ estado_filter }}"
       class="px-3 py-1 rounded-r border border-white/10 bg-white/5 text-gray-300 hover:bg-white/10 transition-colors">
       »
    </a>
  {% else %}
    <span class="px-3 py-1 rounded-r border border-white/10 bg-gray-800 text-gray-500 cursor-not-allowed">»</span>
  {% endif %}
</div>
{% endif %}
{% endblock %}